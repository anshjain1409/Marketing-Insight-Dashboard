<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Insights Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for multiselect */
        select[multiple] {
            scrollbar-width: thin;
            scrollbar-color: #9CA3AF #F3F4F6;
        }
        /* Webkit scrollbar */
        select[multiple]::-webkit-scrollbar {
            width: 8px;
        }
        select[multiple]::-webkit-scrollbar-track {
            background: #F3F4F6;
            border-radius: 10px;
        }
        select[multiple]::-webkit-scrollbar-thumb {
            background-color: #9CA3AF;
            border-radius: 10px;
            border: 2px solid #F3F4F6;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 lg:p-8">
    <div class="max-w-7xl mx-auto">
        
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Marketing Insights Dashboard</h1>
            <p class="text-gray-600">Analyze campaign performance and identify areas for improvement.</p>
        </header>

        <!-- Filters -->
        <div class="mb-6 p-4 bg-white rounded-lg shadow-md">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Date Filters -->
                <div>
                    <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>
                    <input type="date" id="startDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label>
                    <input type="date" id="endDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
                
                <!-- Channel Filter -->
                <div>
                    <label for="channelFilter" class="block text-sm font-medium text-gray-700">Channel (select multiple)</label>
                    <select id="channelFilter" multiple class="mt-1 block w-full h-24 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                
                <!-- Age Group Filter -->
                <div>
                    <label for="ageGroupFilter" class="block text-sm font-medium text-gray-700">Age Group (select multiple)</label>
                    <select id="ageGroupFilter" multiple class="mt-1 block w-full h-24 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
            </div>
            <div class="mt-4 text-right">
                <button id="resetFilters" class="mr-2 px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Reset Filters
                </button>
                <button id="updateButton" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Update Dashboard
                </button>
            </div>
        </div>

        <!-- KPIs Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mb-6">
            <!-- KPI Cards -->
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Total Cost</h3>
                <p id="kpi-cost" class="mt-1 text-2xl font-semibold text-gray-900">$0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Total ROI</h3>
                <p id="kpi-roi" class="mt-1 text-2xl font-semibold text-gray-900">$0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Clicks</h3>
                <p id="kpi-clicks" class="mt-1 text-2xl font-semibold text-gray-900">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Impressions</h3>
                <p id="kpi-impressions" class="mt-1 text-2xl font-semibold text-gray-900">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Conversions</h3>
                <p id="kpi-conversions" class="mt-1 text-2xl font-semibold text-gray-900">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Avg. CTR</h3>
                <p id="kpi-ctr" class="mt-1 text-2xl font-semibold text-gray-900">0%</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Avg. CPC</h3>
                <p id="kpi-cpc" class="mt-1 text-2xl font-semibold text-gray-900">$0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-medium text-gray-500 uppercase">Avg. Conv. Rate</h3>
                <p id="kpi-convRate" class="mt-1 text-2xl font-semibold text-gray-900">0%</p>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Cost vs ROI by Channel -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Cost vs. ROI by Channel</h3>
                <canvas id="costRoiChart"></canvas>
            </div>

            <!-- CTR by Device & Age Group -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Avg. CTR by Device & Age Group</h3>
                <canvas id="deviceAgeChart"></canvas>
            </div>
            
            <!-- Campaign Type Performance -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Campaign Type Performance (Avg. %_</h3>
                <canvas id="campaignTypeChart"></canvas>
            </div>
            
            <!-- Ad Format Performance -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Ad Format Performance (Avg. %_</h3>
                <canvas id="adFormatChart"></canvas>
            </div>
        </div>

        <!-- Tables Grid -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
            <!-- Channel Comparison Table -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Channel Comparison</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Channel</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cost</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ROI</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Clicks</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conversions</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg. CPC</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg. CTR</th>
                            </tr>
                        </thead>
                        <tbody id="channelTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Rows populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Demographic Insights Table -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Demographic & Device Insights</h3>
                 <div class="overflow-x-auto max-h-96">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Segment</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Clicks</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Impressions</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg. CTR</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conversions</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg. Conv. Rate</th>
                            </tr>
                        </thead>
                        <tbody id="demographicTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Rows populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- EMBEDDED SAMPLE DATA ---
        // I'm embedding the first 100 rows of your CSV for a working demo.
        const csvData = `Date,Channel,Country,Device,Age Group,Gender,Campaign Type,Ad Format,Impressions,Clicks,Conversions,Bounce Rate (%),Cost ($),CTR (%),CPC ($),Conversion Rate (%)
2024-02-10,Google Ads,USA,Mobile,18-24,Female,Consideration,Image,32892,8510,1898,37.26,1367.76,25.87,0.16,22.3
2024-01-16,Instagram,UK,Tablet,25-34,Male,Conversion,Image,31002,6620,85,39.3,1203.06,21.35,0.18,1.28
2024-02-12,Google Ads,USA,Tablet,55+,Male,Conversion,Image,44891,10801,29,62.2,1078.98,24.06,0.1,0.27
2024-02-14,Google Ads,Australia,Mobile,55+,Other,Consideration,Text,43219,361,135,26.34,666.88,0.84,1.85,37.4
2024-02-25,Google Ads,Canada,Desktop,25-34,Other,Conversion,Image,43695,18109,2429,69.57,2882.59,41.44,0.16,13.41
2024-02-03,Instagram,USA,Mobile,18-24,Female,Consideration,Text,11605,699,53,52.01,231.33,6.02,0.33,7.58
2024-02-12,Google Ads,UK,Mobile,35-44,Male,Consideration,Carousel,48536,2150,865,49.79,343.37,4.43,0.16,40.23
2024-03-08,Email,UK,Mobile,35-44,Male,Awareness,Carousel,42945,8417,2118,52.5,1479.52,19.6,0.18,25.16
2024-01-26,Facebook,USA,Mobile,25-34,Female,Conversion,Carousel,21869,1498,300,56.28,241.14,6.85,0.16,20.03
2024-02-16,Twitter,Canada,Desktop,18-24,Male,Awareness,Text,37388,5272,30,42.89,1650.69,14.1,0.31,0.57
2024-01-21,Google Ads,USA,Mobile,18-24,Male,Consideration,Image,42563,1681,643,30.56,275.61,3.95,0.16,38.25
2024-02-05,Facebook,USA,Desktop,35-44,Male,Conversion,Image,44897,1432,549,41.05,236.4,3.19,0.16,38.34
2024-03-10,Instagram,USA,Desktop,25-34,Female,Conversion,Video,35939,1218,485,41.93,313.14,3.39,0.26,39.82
2024-03-11,LinkedIn,USA,Mobile,25-34,Female,Awareness,Carousel,33230,1238,260,28.32,233.15,3.73,0.19,21.0
2024-01-04,Instagram,UK,Tablet,35-44,Male,Awareness,Text,33028,12239,360,40.38,2068.79,37.06,0.17,2.94
2024-02-17,Facebook,USA,Mobile,18-24,Male,Awareness,Carousel,47239,9736,2420,38.25,1600.5,20.61,0.16,24.86
2024-02-14,Twitter,UK,Tablet,18-24,Male,Consideration,Video,45484,10373,2674,38.27,3304.53,22.81,0.32,25.78
2024-02-09,Email,USA,Mobile,18-24,Female,Awareness,Carousel,13998,2296,554,23.11,353.11,16.4,0.15,24.13
2024-01-28,LinkedIn,USA,Tablet,35-44,Male,Consideration,Text,29622,340,111,28.1,59.38,1.15,0.17,32.65
2024-01-27,Twitter,USA,Desktop,18-24,Other,Conversion,Carousel,38487,2271,20,58.74,707.97,5.9,0.31,0.88
2024-01-18,Google Ads,Canada,Tablet,18-24,Female,Conversion,Image,36628,14022,4018,45.45,2148.9,38.28,0.15,28.65
2024-02-14,Google Ads,USA,Tablet,45-54,Female,Conversion,Video,42171,1542,30,55.93,253.3,3.66,0.16,1.95
2024-03-12,Twitter,UK,Mobile,35-44,Other,Awareness,Carousel,41870,11347,2882,53.64,3605.9,27.09,0.32,25.4
2024-01-13,Instagram,USA,Mobile,18-24,Male,Awareness,Video,48443,10173,1242,50.11,2604.42,21.0,0.26,12.21
2024-01-21,Instagram,USA,Mobile,18-24,Male,Awareness,Carousel,37311,7688,969,50.29,1970.76,20.6,0.26,12.6
2024-01-25,Instagram,USA,Mobile,18-24,Female,Consideration,Carousel,22675,5033,1292,30.31,1302.58,22.19,0.26,25.67
2024-01-16,Instagram,UK,Mobile,45-54,Male,Conversion,Text,33501,5762,2162,25.75,1458.26,17.2,0.25,37.52
2024-02-23,LinkedIn,Australia,Mobile,25-34,Female,Conversion,Carousel,35874,1033,371,31.43,192.51,2.88,0.19,35.91
2024-02-09,Twitter,USA,Desktop,25-34,Female,Consideration,Video,40791,1338,477,36.56,419.08,3.28,0.31,35.65
2024-03-01,Instagram,USA,Mobile,25-34,Female,Awareness,Carousel,37894,7730,974,50.08,1981.38,20.4,0.26,12.6
2024-01-18,Email,UK,Mobile,25-34,Male,Awareness,Carousel,47230,9021,2241,49.88,1413.56,19.1,0.16,24.84
2024-02-20,Google Ads,Canada,Desktop,35-44,Male,Awareness,Text,36145,2133,26,43.23,348.69,5.9,0.16,1.22
2024-03-05,Facebook,USA,Mobile,25-34,Female,Conversion,Video,25816,5292,1323,38.25,854.21,20.5,0.16,25.0
2024-03-02,Twitter,USA,Desktop,45-54,Male,Consideration,Video,42137,13778,3502,38.16,4389.26,32.7,0.32,25.42
2024-02-01,Instagram,UK,Tablet,35-44,Male,Conversion,Carousel,33642,7325,88,39.42,1852.12,21.77,0.25,1.2
2024-03-03,Email,UK,Mobile,35-44,Male,Awareness,Carousel,43343,8491,2136,52.51,1507.03,19.59,0.18,25.16
2024-01-26,Instagram,UK,Mobile,45-54,Male,Conversion,Text,33737,5802,2178,25.76,1468.27,17.2,0.25,37.53
2024-01-13,Instagram,USA,Mobile,18-24,Male,Awareness,Video,48443,10173,1242,50.11,2604.42,21.0,0.26,12.21
2024-02-12,Google Ads,UK,Mobile,35-44,Male,Consideration,Carousel,48536,2150,865,49.79,343.37,4.43,0.16,40.23
2024-01-04,Instagram,UK,Tablet,35-44,Male,Awareness,Text,33028,12239,360,40.38,2068.79,37.06,0.17,2.94
2Data,Channel,Country,Device,Age Group,Gender,Campaign Type,Ad Format,Impressions,Clicks,Conversions,Bounce Rate (%),Cost ($),CTR (%),CPC ($),Conversion Rate (%)
2024-02-09,Email,USA,Mobile,18-24,Female,Awareness,Carousel,13998,2296,554,23.11,353.11,16.4,0.15,24.13
2024-01-28,LinkedIn,USA,Tablet,35-44,Male,Consideration,Text,29622,340,111,28.1,59.38,1.15,0.17,32.65
2024-02-03,Instagram,USA,Mobile,18-24,Female,Consideration,Text,11605,699,53,52.01,231.33,6.02,0.33,7.58
2024-02-17,Facebook,USA,Mobile,18-24,Male,Awareness,Carousel,47239,9736,2420,38.25,1600.5,20.61,0.16,24.86
2024-02-05,Facebook,USA,Desktop,35-44,Male,Conversion,Image,44897,1432,549,41.05,236.4,3.19,0.16,38.34
s,USA,Tablet,55+,Male,Conversion,Image,44891,10801,29,62.2,1078.98,24.06,0.1,0.27
2024-02-16,Twitter,Canada,Desktop,18-24,Male,Awareness,Text,37388,5272,30,42.89,1650.69,14.1,0.31,0.57
2024-01-21,Google Ads,USA,Mobile,18-24,Male,Consideration,Image,42563,1681,643,30.56,275.61,3.95,0.16,38.25
2024-03-10,Instagram,USA,Desktop,25-34,Female,Conversion,Video,35939,1218,485,41.93,313.14,3.39,0.26,39.82
2024-02-23,LinkedIn,Australia,Mobile,25-34,Female,Conversion,Carousel,35874,1033,371,31.43,192.51,2.88,0.19,35.91
2024-01-18,Email,UK,Mobile,25-34,Male,Awareness,Carousel,47230,9021,2241,49.88,1413.56,19.1,0.16,24.84
2024-03-05,Facebook,USA,Mobile,25-34,Female,Conversion,Video,25816,5292,1323,38.25,854.21,20.5,0.16,25.0
2024-03-03,Email,UK,Mobile,35-44,Male,Awareness,Carousel,43343,8491,2136,52.51,1507.03,19.59,0.18,25.16
2024-01-26,Instagram,UK,Mobile,45-54,Male,Conversion,Text,33737,5802,2178,25.76,1468.27,17.2,0.25,37.53
2024-02-12,Google Ads,UK,Mobile,35-44,Male,Consideration,Carousel,48536,2150,865,49.79,343.37,4.43,0.16,40.23
2024-01-04,Instagram,UK,Tablet,35-44,Male,Awareness,Text,33028,12239,360,40.38,2068.79,37.06,0.17,2.94
2024-01-27,Twitter,USA,Desktop,18-24,Other,Conversion,Carousel,38487,2271,20,58.74,707.97,5.9,0.31,0.88
2024-03-12,Twitter,UK,Mobile,35-44,Other,Awareness,Carousel,41870,11347,2882,53.64,3605.9,27.09,0.32,25.4
2024-01-13,Instagram,USA,Mobile,18-24,Male,Awareness,Video,48443,10173,1242,50.11,2604.42,21.0,0.26,12.21
2024-01-21,Instagram,USA,Mobile,18-24,Male,Awareness,Carousel,37311,7688,969,50.29,1970.76,20.6,0.26,12.6
2024-01-25,Instagram,USA,Mobile,18-24,Female,Consideration,Carousel,22675,5033,1292,30.31,1302.58,22.19,0.26,25.67
2024-01-16,Instagram,UK,Mobile,45-54,Male,Conversion,Text,33501,5762,2162,25.75,1458.26,17.2,0.25,37.52
2024-02-09,Twitter,USA,Desktop,25-34,Female,Consideration,Video,40791,1338,477,36.56,419.08,3.28,0.31,35.65
2024-03-01,Instagram,USA,Mobile,25-34,Female,Awareness,Carousel,37894,7730,974,50.08,1981.38,20.4,0.26,12.6
2024-02-20,Google Ads,Canada,Desktop,35-44,Male,Awareness,Text,36145,2133,26,43.23,348.69,5.9,0.16,1.22
2024-03-02,Twitter,USA,Desktop,45-54,Male,Consideration,Video,42137,13778,3502,38.16,4389.26,32.7,0.32,25.42
2024-02-01,Instagram,UK,Tablet,35-44,Male,Conversion,Carousel,33642,7325,88,39.42,1852.12,21.77,0.25,1.2
2024-01-18,Google Ads,Canada,Tablet,18-24,Female,Conversion,Image,36628,14022,4018,45.45,2148.9,38.28,0.15,28.65
2024-02-14,Google Ads,USA,Tablet,45-54,Female,Conversion,Video,42171,1542,30,55.93,253.3,3.66,0.16,1.95
2024-02-10,Google Ads,USA,Mobile,18-24,Female,Consideration,Image,32892,8510,1898,37.26,1367.76,25.87,0.16,22.3
2024-01-16,Instagram,UK,Tablet,25-34,Male,Conversion,Image,31002,6620,85,39.3,1203.06,21.35,0.18,1.28
2024-02-12,Google Ads,USA,Tablet,55+,Male,Conversion,Image,44891,10801,29,62.2,1078.98,24.06,0.1,0.27
2024-02-14,Google Ads,Australia,Mobile,55+,Other,Consideration,Text,43219,361,135,26.34,666.88,0.84,1.85,37.4
2024-02-25,Google Ads,Canada,Desktop,25-34,Other,Conversion,Image,43695,18109,2429,69.57,2882.59,41.44,0.16,13.41
2024-02-03,Instagram,USA,Mobile,18-24,Female,Consideration,Text,11605,699,53,52.01,231.33,6.02,0.33,7.58
2024-02-12,Google Ads,UK,Mobile,35-44,Male,Consideration,Carousel,48536,2150,865,49.79,343.37,4.43,0.16,40.23
2024-03-08,Email,UK,Mobile,35-44,Male,Awareness,Carousel,42945,8417,2118,52.5,1479.52,19.6,0.18,25.16
2024-01-26,Facebook,USA,Mobile,25-34,Female,Conversion,Carousel,21869,1498,300,56.28,241.14,6.85,0.16,20.03
2024-02-16,Twitter,Canada,Desktop,18-24,Male,Awareness,Text,37388,5272,30,42.89,1650.69,14.1,0.31,0.57
2024-01-21,Google Ads,USA,Mobile,18-24,Male,Consideration,Image,42563,1681,643,30.56,275.61,3.95,0.16,38.25
2024-02-05,Facebook,USA,Desktop,35-44,Male,Conversion,Image,44897,1432,549,41.05,236.4,3.19,0.16,38.34
2024-03-10,Instagram,USA,Desktop,25-34,Female,Conversion,Video,35939,1218,485,41.93,313.14,3.39,0.26,39.82
2024-03-11,LinkedIn,USA,Mobile,25-34,Female,Awareness,Carousel,33230,1238,260,28.32,233.15,3.73,0.19,21.0
2024-01-04,Instagram,UK,Tablet,35-44,Male,Awareness,Text,33028,12239,360,40.38,2068.79,37.06,0.17,2.94
2024-02-17,Facebook,USA,Mobile,18-24,Male,Awareness,Carousel,47239,9736,2420,38.25,1600.5,20.61,0.16,24.86
2024-02-14,Twitter,UK,Tablet,18-24,Male,Consideration,Video,45484,10373,2674,38.27,3304.53,22.81,0.32,25.78
2024-02-09,Email,USA,Mobile,18-24,Female,Awareness,Carousel,13998,2296,554,23.11,353.11,16.4,0.15,24.13
2024-01-28,LinkedIn,USA,Tablet,35-44,Male,Consideration,Text,29622,340,111,28.1,59.38,1.15,0.17,32.65
2024-01-27,Twitter,USA,Desktop,18-24,Other,Conversion,Carousel,38487,2271,20,58.74,707.97,5.9,0.31,0.88
2024-01-18,Google Ads,Canada,Tablet,18-24,Female,Conversion,Image,36628,14022,4018,45.45,2148.9,38.28,0.15,28.65
2024-02-14,Google Ads,USA,Tablet,45-54,Female,Conversion,Video,42171,1542,30,55.93,253.3,3.66,0.16,1.95
2024-03-12,Twitter,UK,Mobile,35-44,Other,Awareness,Carousel,41870,11347,2882,53.64,3605.9,27.09,0.32,25.4
2024-01-13,Instagram,USA,Mobile,18-24,Male,Awareness,Video,48443,10173,1242,50.11,2604.42,21.0,0.26,12.21
2024-01-21,Instagram,USA,Mobile,18-24,Male,Awareness,Carousel,37311,7688,969,50.29,1970.76,20.6,0.26,12.6
2024-01-25,Instagram,USA,Mobile,18-24,Female,Consideration,Carousel,22675,5033,1292,30.31,1302.58,22.19,0.26,25.67
2024-01-16,Instagram,UK,Mobile,45-54,Male,Conversion,Text,33501,5762,2162,25.75,1458.26,17.2,0.25,37.52
2024-02-23,LinkedIn,Australia,Mobile,25-34,Female,Conversion,Carousel,35874,1033,371,31.43,192.51,2.88,0.19,35.91
2024-02-09,Twitter,USA,Desktop,25-34,Female,Consideration,Video,40791,1338,477,36.56,419.08,3.28,0.31,35.65
2024-03-01,Instagram,USA,Mobile,25-34,Female,Awareness,Carousel,37894,7730,974,50.08,1981.38,20.4,0.26,12.6
a,Desktop,35-44,Male,Awareness,Text,36145,2133,26,43.23,348.69,5.9,0.16,1.22
2024-03-02,Twitter,USA,Desktop,45-54,Male,Consideration,Video,42137,13778,3502,38.16,4389.26,32.7,0.32,25.42
2024-02-01,Instagram,UK,Tablet,35-44,Male,Conversion,Carousel,33642,7325,88,39.42,1852.12,21.77,0.25,1.2
2024-03-03,Email,UK,Mobile,35-44,Male,Awareness,Carousel,43343,8491,2136,52.51,1507.03,19.59,0.18,25.16
2024-01-26,Instagram,UK,Mobile,45-54,Male,Conversion,Text,33737,5802,2178,25.76,1468.27,17.2,0.25,37.53`;

        // --- GLOBAL VARIABLES ---
        let allData = [];
        let chartInstances = {}; // To store chart objects for update/destroy
        // Based on your rationale: ROI = (Conversions * 500) - Cost
        const CONVERSION_VALUE = 500; 

        // --- HELPER FUNCTIONS ---

        /**
         * Parses CSV text into an array of objects.
         */
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split(',');
                return headers.reduce((obj, header, index) => {
                    obj[header] = values[index] ? values[index].trim() : '';
                    return obj;
                }, {});
            });
        }

        /**
         * Cleans and processes raw data from CSV.
         * Calculates ROI and converts strings to numbers.
         */
        function processData(data) {
            return data.map(d => {
                const conversions = parseFloat(d.Conversions) || 0;
                const cost = parseFloat(d['Cost ($)']) || 0;
                
                return {
                    ...d,
                    Date: new Date(d.Date),
                    Impressions: parseInt(d.Impressions) || 0,
                    Clicks: parseInt(d.Clicks) || 0,
                    Conversions: conversions,
                    'Bounce Rate (%)': parseFloat(d['Bounce Rate (%)']) || 0,
                    'Cost ($)': cost,
                    'CTR (%)': parseFloat(d['CTR (%)']) || 0,
                    'CPC ($)': parseFloat(d['CPC ($)']) || 0,
                    'Conversion Rate (%)': parseFloat(d['Conversion Rate (%)']) || 0,
                    // Calculate ROI based on the rationale
                    ROI: (conversions * CONVERSION_VALUE) - cost
                };
            }).filter(d => d.Date instanceof Date && !isNaN(d.Date)); // Ensure date is valid
        }

        /**
         * Populates filter dropdowns with unique values from the data.
         */
        function populateFilters(data) {
            const channels = [...new Set(data.map(d => d.Channel))].sort();
            const ageGroups = [...new Set(data.map(d => d['Age Group']))].sort();
            
            const channelSelect = document.getElementById('channelFilter');
            const ageGroupSelect = document.getElementById('ageGroupFilter');
            
            channels.forEach(c => channelSelect.innerHTML += `<option value="${c}">${c}</option>`);
            ageGroups.forEach(a => ageGroupSelect.innerHTML += `<option value="${a}">${a}</option>`);
            
            // Set default date range
            const dates = data.map(d => d.Date);
            const minDate = new Date(Math.min(...dates));
            const maxDate = new Date(Math.max(...dates));
            
            document.getElementById('startDate').value = minDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = maxDate.toISOString().split('T')[0];
        }
        
        /**
         * Resets all filters to their default state.
         */
        function resetAllFilters() {
            // Reset dates
            const dates = allData.map(d => d.Date);
            const minDate = new Date(Math.min(...dates));
            const maxDate = new Date(Math.max(...dates));
            document.getElementById('startDate').value = minDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = maxDate.toISOString().split('T')[0];
            
            // Clear multi-selects
            document.querySelectorAll('#channelFilter option').forEach(opt => opt.selected = false);
            document.querySelectorAll('#ageGroupFilter option').forEach(opt => opt.selected = false);
            
            // Update dashboard with all data
            updateDashboard();
        }

        /**
         * Gets selected values from a multi-select element.
         */
        function getMultiSelectValues(elementId) {
            const select = document.getElementById(elementId);
            return Array.from(select.options)
                .filter(option => option.selected)
                .map(option => option.value);
        }
        
        /**
         * Formats numbers for display (e.g., 1000 -> 1K, 1234.56 -> $1,234.57)
         */
        const formatLargeNumber = (num) => {
            if (Math.abs(num) > 999999) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (Math.abs(num) > 999) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString(undefined, { maximumFractionDigits: 0 });
        };
        const formatCurrency = (num) => {
             if (Math.abs(num) > 999999) {
                return '$' + (num / 1000000).toFixed(1) + 'M';
            } else if (Math.abs(num) > 999) {
                return '$' + (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
        };

        // --- UPDATE FUNCTIONS ---

        /**
         * Main function to filter data and update all dashboard components.
         */
        function updateDashboard() {
            // Get filter values
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const selectedChannels = getMultiSelectValues('channelFilter');
            const selectedAgeGroups = getMultiSelectValues('ageGroupFilter');
            
            // Filter data
            const filteredData = allData.filter(d => {
                const dateMatch = d.Date >= startDate && d.Date <= endDate;
                const channelMatch = selectedChannels.length === 0 || selectedChannels.includes(d.Channel);
                const ageGroupMatch = selectedAgeGroups.length === 0 || selectedAgeGroups.includes(d['Age Group']);
                return dateMatch && channelMatch && ageGroupMatch;
            });

            // Update all dashboard components
            updateKPIs(filteredData);
            updateCostRoiChart(filteredData);
            updateDeviceAgeChart(filteredData);
            updateCampaignTypeChart(filteredData);
            updateAdFormatChart(filteredData);
            updateChannelTable(filteredData);
            updateDemographicTable(filteredData);
        }
        
        /**
         * Calculates and displays main KPIs.
         */
        function updateKPIs(data) {
            const totalCost = data.reduce((sum, d) => sum + d['Cost ($)'], 0);
            const totalROI = data.reduce((sum, d) => sum + d.ROI, 0);
            const totalClicks = data.reduce((sum, d) => sum + d.Clicks, 0);
            const totalImpressions = data.reduce((sum, d) => sum + d.Impressions, 0);
            const totalConversions = data.reduce((sum, d) => sum + d.Conversions, 0);
            
            // For averages, we need to be careful about 0-count
            const avgCTR = data.length ? data.reduce((sum, d) => sum + d['CTR (%)'], 0) / data.length : 0;
            const avgCPC = data.length ? data.reduce((sum, d) => sum + d['CPC ($)'], 0) / data.length : 0;
            const avgConvRate = data.length ? data.reduce((sum, d) => sum + d['Conversion Rate (%)'], 0) / data.length : 0;

            document.getElementById('kpi-cost').innerText = formatCurrency(totalCost);
            document.getElementById('kpi-roi').innerText = formatCurrency(totalROI);
            document.getElementById('kpi-clicks').innerText = formatLargeNumber(totalClicks);
            document.getElementById('kpi-impressions').innerText = formatLargeNumber(totalImpressions);
            document.getElementById('kpi-conversions').innerText = formatLargeNumber(totalConversions);
            document.getElementById('kpi-ctr').innerText = `${avgCTR.toFixed(2)}%`;
            document.getElementById('kpi-cpc').innerText = `$${avgCPC.toFixed(2)}`;
            document.getElementById('kpi-convRate').innerText = `${avgConvRate.toFixed(2)}%`;
        }

        /**
         * Updates "Cost vs. ROI by Channel" chart.
         */
        function updateCostRoiChart(data) {
            const ctx = document.getElementById('costRoiChart').getContext('2d');
            
            // Aggregate data
            const grouped = data.reduce((acc, d) => {
                if (!acc[d.Channel]) {
                    acc[d.Channel] = { cost: 0, roi: 0 };
                }
                acc[d.Channel].cost += d['Cost ($)'];
                acc[d.Channel].roi += d.ROI;
                return acc;
            }, {});
            
            const labels = Object.keys(grouped).sort((a,b) => grouped[b].roi - grouped[a].roi);
            const costData = labels.map(l => grouped[l].cost);
            const roiData = labels.map(l => grouped[l].roi);
            
            if (chartInstances.costRoi) chartInstances.costRoi.destroy();
            
            chartInstances.costRoi = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Total Cost',
                            data: costData,
                            backgroundColor: '#9CA3AF', // gray-400
                            borderColor: '#9CA3AF',
                            borderWidth: 1
                        },
                        {
                            label: 'Total ROI',
                            data: roiData,
                            backgroundColor: '#4F46E5', // indigo-600
                            borderColor: '#4F46E5',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => formatCurrency(value)
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.dataset.label}: ${formatCurrency(context.raw)}`
                            }
                        }
                    }
                }
            });
        }
        
        /**
         * Updates "Avg. CTR by Device & Age Group" chart.
         */
        function updateDeviceAgeChart(data) {
            const ctx = document.getElementById('deviceAgeChart').getContext('2d');
            
            const ageGroups = [...new Set(data.map(d => d['Age Group']))].sort();
            const devices = [...new Set(data.map(d => d.Device))].sort();
            
            // Aggregate data: avg CTR for each Age/Device combo
            const grouped = data.reduce((acc, d) => {
                const key = `${d['Age Group']}|${d.Device}`;
                if (!acc[key]) {
                    acc[key] = { totalCtr: 0, count: 0 };
                }
                acc[key].totalCtr += d['CTR (%)'];
                acc[key].count++;
                return acc;
            }, {});

            const datasets = devices.map((device, index) => {
                const colors = ['#4F46E5', '#10B981', '#F59E0B']; // indigo, emerald, amber
                return {
                    label: device,
                    data: ageGroups.map(age => {
                        const key = `${age}|${device}`;
                        return grouped[key] ? grouped[key].totalCtr / grouped[key].count : 0;
                    }),
                    backgroundColor: colors[index % colors.length],
                    borderColor: colors[index % colors.length],
                };
            });

            if (chartInstances.deviceAge) chartInstances.deviceAge.destroy();
            
            chartInstances.deviceAge = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ageGroups,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Avg. CTR (%)' }
                        }
                    },
                     plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.dataset.label}: ${context.raw.toFixed(2)}%`
                            }
                        }
                    }
                }
            });
        }
        
        /**
         * Updates "Campaign Type Performance" chart (Bounce vs. Conversion Rate).
         */
        function updateCampaignTypeChart(data) {
            const ctx = document.getElementById('campaignTypeChart').getContext('2d');
            
            const types = [...new Set(data.map(d => d['Campaign Type']))].sort();
            
            // Aggregate data: avg Bounce Rate and Conversion Rate
            const grouped = data.reduce((acc, d) => {
                const key = d['Campaign Type'];
                if (!acc[key]) {
                    acc[key] = { totalBounce: 0, totalConvRate: 0, count: 0 };
                }
                acc[key].totalBounce += d['Bounce Rate (%)'];
                acc[key].totalConvRate += d['Conversion Rate (%)'];
                acc[key].count++;
                return acc;
            }, {});

            const avgBounceData = types.map(type => grouped[type] ? grouped[type].totalBounce / grouped[type].count : 0);
            const avgConvRateData = types.map(type => grouped[type] ? grouped[type].totalConvRate / grouped[type].count : 0);

            if (chartInstances.campaignType) chartInstances.campaignType.destroy();
            
            chartInstances.campaignType = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: types,
                    datasets: [
                        {
                            label: 'Avg. Bounce Rate',
                            data: avgBounceData,
                            backgroundColor: '#EF4444', // red-500
                        },
                        {
                            label: 'Avg. Conversion Rate',
                            data: avgConvRateData,
                            backgroundColor: '#22C55E', // green-500
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Average Rate (%)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.dataset.label}: ${context.raw.toFixed(2)}%`
                            }
                        }
                    }
                }
            });
        }
        
        /**
         * Updates "Ad Format Performance" chart.
         */
        function updateAdFormatChart(data) {
             const ctx = document.getElementById('adFormatChart').getContext('2d');
            
            const formats = [...new Set(data.map(d => d['Ad Format']))].sort();
            
            // Aggregate data: avg CTR and Conversion Rate
            const grouped = data.reduce((acc, d) => {
                const key = d['Ad Format'];
                if (!acc[key]) {
                    acc[key] = { totalCtr: 0, totalConvRate: 0, count: 0 };
                }
                acc[key].totalCtr += d['CTR (%)'];
                acc[key].totalConvRate += d['Conversion Rate (%)'];
                acc[key].count++;
                return acc;
            }, {});

            const avgCtrData = formats.map(format => grouped[format] ? grouped[format].totalCtr / grouped[format].count : 0);
            const avgConvRateData = formats.map(format => grouped[format] ? grouped[format].totalConvRate / grouped[format].count : 0);

            if (chartInstances.adFormat) chartInstances.adFormat.destroy();
            
            chartInstances.adFormat = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: formats,
                    datasets: [
                        {
                            label: 'Avg. CTR',
                            data: avgCtrData,
                            backgroundColor: '#3B82F6', // blue-500
                        },
                        {
                            label: 'Avg. Conversion Rate',
                            data: avgConvRateData,
                            backgroundColor: '#14B8A6', // teal-500
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Average Rate (%)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.dataset.label}: ${context.raw.toFixed(2)}%`
                            }
                        }
                    }
                }
            });
        }
        
        /**
         * Updates the "Channel Comparison" table.
         */
        function updateChannelTable(data) {
            const tableBody = document.getElementById('channelTableBody');
            tableBody.innerHTML = '';
            
            const grouped = data.reduce((acc, d) => {
                const key = d.Channel;
                if (!acc[key]) {
                    acc[key] = { cost: 0, roi: 0, clicks: 0, conversions: 0, totalCpc: 0, totalCtr: 0, count: 0 };
                }
                acc[key].cost += d['Cost ($)'];
                acc[key].roi += d.ROI;
                acc[key].clicks += d.Clicks;
                acc[key].conversions += d.Conversions;
                acc[key].totalCpc += d['CPC ($)'];
                acc[key].totalCtr += d['CTR (%)'];
                acc[key].count++;
                return acc;
            }, {});
            
            const sorted = Object.entries(grouped).sort(([,a], [,b]) => b.roi - a.roi);

            for (const [channel, metrics] of sorted) {
                const avgCpc = metrics.count ? metrics.totalCpc / metrics.count : 0;
                const avgCtr = metrics.count ? metrics.totalCtr / metrics.count : 0;
                
                const row = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${channel}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatCurrency(metrics.cost)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatCurrency(metrics.roi)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatLargeNumber(metrics.clicks)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatLargeNumber(metrics.conversions)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">$${avgCpc.toFixed(2)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${avgCtr.toFixed(2)}%</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            }
        }
        
        /**
         * Updates the "Demographic Insights" table.
         */
        function updateDemographicTable(data) {
            const tableBody = document.getElementById('demographicTableBody');
            tableBody.innerHTML = '';

            const grouped = data.reduce((acc, d) => {
                const key = `${d['Age Group']} | ${d.Gender} | ${d.Device}`;
                if (!acc[key]) {
                    acc[key] = { clicks: 0, impressions: 0, conversions: 0, totalCtr: 0, totalConvRate: 0, count: 0 };
                }
                acc[key].clicks += d.Clicks;
                acc[key].impressions += d.Impressions;
                acc[key].conversions += d.Conversions;
                acc[key].totalCtr += d['CTR (%)'];
                acc[key].totalConvRate += d['Conversion Rate (%)'];
                acc[key].count++;
                return acc;
            }, {});
            
            const sorted = Object.entries(grouped).sort(([,a], [,b]) => b.clicks - a.clicks);

            for (const [segment, metrics] of sorted) {
                const avgCtr = metrics.count ? metrics.totalCtr / metrics.count : 0;
                const avgConvRate = metrics.count ? metrics.totalConvRate / metrics.count : 0;

                const row = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${segment}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatLargeNumber(metrics.clicks)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatLargeNumber(metrics.impressions)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${avgCtr.toFixed(2)}%</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatLargeNumber(metrics.conversions)}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${avgConvRate.toFixed(2)}%</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            }
        }
        
        // --- INITIALIZATION ---
        
        /**
         * Runs when the page loads.
         */
        function initialize() {
            allData = processData(parseCSV(csvData));
            populateFilters(allData);
            updateDashboard();
            
            // Add event listeners
            document.getElementById('updateButton').addEventListener('click', updateDashboard);
            document.getElementById('resetFilters').addEventListener('click', resetAllFilters);
        }
        
        // Wait for the DOM to be fully loaded before initializing
        document.addEventListener('DOMContentLoaded', initialize);

    </script>
</body>
</html>
